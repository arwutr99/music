<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏û‡∏•‡∏á Mini YouTube By Arwut</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; background: #f0f0f0; }
    input, button { padding: 10px; font-size: 16px; margin: 5px; }
    iframe { margin-top: 20px; width: 100%; max-width: 560px; height: 315px; border: none; }
    .history, .playlist { margin-top: 30px; max-width: 600px; margin-left: auto; margin-right: auto; text-align: left; }
    .history-item, .playlist-item { margin-bottom: 5px; cursor: pointer; color: blue; text-decoration: underline; }
    .tag { font-size: 13px; color: #555; background: #e0e0e0; padding: 3px 7px; border-radius: 5px; margin-left: 5px; }
    .btn-clear { background: red; color: white; }
  </style>
</head>
<body>

  <h1>üéµ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏û‡∏•‡∏áüéµ </h1>
  <input id="searchInput" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô..." />
  <button onclick="search()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
  <button onclick="showHistory()">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
  <button onclick="clearHistory()" class="btn-clear">‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  <button onclick="playPlaylist()">üéµ ‡πÄ‡∏•‡πà‡∏ô Playlist ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á</button>
  <hr>
  <button onclick="adminLogin()">üë®‚Äç‚öñÔ∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</button>
  <div id="adminPanel" style="display:none; margin-top:20px;">
    <h3>üõ†Ô∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô API Key (Admin)</h3>
    <input id="newApiKey" placeholder="‡∏ß‡∏≤‡∏á API Key ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." style="width:80%;" />
    <button onclick="saveApiKey()">üìÇ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </div>

  <div id="result"></div>
  <div class="history" id="history"></div>

  <script>
    let API_KEY = 'AIzaSyB5ho_NRgYf8yZZgBGqP6LrEB4N2NsV85g';
    let savedKey = localStorage.getItem('admin_api_key');
    if (savedKey) {
      API_KEY = savedKey;
    }
    let cache = JSON.parse(localStorage.getItem('yt_cache') || '{}');
    let playerQueue = [];
    let currentIndex = 0;
    let player;

    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('result', {
        height: '315',
        width: '560',
        videoId: '',
        events: { 'onStateChange': onPlayerStateChange },
        playerVars: { autoplay: 1, mute: 1 }
      });
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED && playerQueue.length > 0) {
        currentIndex++;
        if (currentIndex < playerQueue.length) {
          player.loadVideoById(playerQueue[currentIndex]);
        }
      }
    }

    async function search() {
      const query = document.getElementById('searchInput').value.trim().toLowerCase();
      if (!query) return;
      if (cache[query]) {
        playVideo(cache[query].videoId, cache[query].title);
        return;
      }
      const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=1&q=${encodeURIComponent(query)}&key=${API_KEY}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        if (data.items && data.items.length > 0) {
          const videoId = data.items[0].id.videoId;
          const title = data.items[0].snippet.title;
          cache[query] = { videoId, title };
          localStorage.setItem('yt_cache', JSON.stringify(cache));
          playVideo(videoId, title);
        } else {
          document.getElementById('result').innerHTML = `<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Ñ‡πà‡∏∞ üò¢</p>`;
        }
      } catch (e) {
        document.getElementById('result').innerHTML = `<p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}</p>`;
      }
    }

    function playVideo(videoId, title) {
      document.getElementById('result').innerHTML = `<h2>${title}</h2>`;
      player.loadVideoById(videoId);
    }

    function showHistory() {
      const historyDiv = document.getElementById('history');
      historyDiv.innerHTML = `<h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>`;
      const categories = {};
      for (const query in cache) {
        const genre = detectGenre(query);
        if (!categories[genre]) categories[genre] = [];
        categories[genre].push({ query, ...cache[query] });
      }
      for (const genre in categories) {
        historyDiv.innerHTML += `<h4>${genre}</h4>`;
        categories[genre].forEach(item => {
          historyDiv.innerHTML += `
            <div class="history-item" onclick="playVideo('${item.videoId}', '${item.title.replace(/'/g, "\\'")}')">
              üéµ ${item.title} <span class="tag">${item.query}</span>
            </div>
          `;
        });
      }
    }

    function detectGenre(query) {
      if (query.includes('lofi') || query.includes('chill')) return 'üõå Lofi/Chill';
      if (query.includes('rock')) return 'üé∏ Rock';
      if (query.includes('cover')) return 'üé§ Cover';
      if (query.includes('remix')) return 'üéõÔ∏è Remix';
      if (query.includes('rap') || query.includes('hiphop')) return 'üéß Rap/Hip-Hop';
      return 'üìÇ ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ';
    }

    function clearHistory() {
      if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
        localStorage.removeItem('yt_cache');
        cache = {};
        document.getElementById('history').innerHTML = '';
        alert("‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡πà‡∏∞ üßπ");
      }
    }

    function playPlaylist() {
      playerQueue = Object.values(cache).map(item => item.videoId);
      currentIndex = 0;
      if (playerQueue.length > 0) {
        const firstTitle = Object.values(cache)[0].title;
        document.getElementById('result').innerHTML = `<h2>${firstTitle}</h2>`;
        player.loadVideoById(playerQueue[0]);
      }
    }

    function adminLogin() {
      const pass = prompt("‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•:");
      if (pass === 'nimda') {
        document.getElementById('adminPanel').style.display = 'block';
      } else {
        alert('‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡πà‡∏∞ ‚ùå');
      }
    }

    function saveApiKey() {
      const newKey = document.getElementById('newApiKey').value.trim();
      if (!newKey) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å API Key ‡∏Ñ‡πà‡∏∞");
      localStorage.setItem('admin_api_key', newKey);
      alert('‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô API Key ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
    }
  </script>
</body>
</html>
